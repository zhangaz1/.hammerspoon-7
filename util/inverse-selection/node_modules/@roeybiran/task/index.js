"use strict";

const util = require("util");
const cp = require("child_process");

const execFile = util.promisify(cp.execFile);
const DEFAULT_MAX_BUFFER = 1000 * 1000 * 100;

/**
 * @param {string} program - a program/file to execute.
 * @param {string[]} args - the program's arguments.
 * @param {number} timeout - number of milliseconds after which the prcoess will be terminated.
 */
module.exports.execFile = async (program, args, timeout = 0) => {
  try {
    const result = await execFile(program, args, {
      maxBuffer: DEFAULT_MAX_BUFFER,
      timeout
    });
    return {
      stdout: result.stdout.trim(),
      stderr: result.stderr.trim()
    };
  } catch (error) {
    throw error;
  }
};
